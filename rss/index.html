<channel><title></title><description></description><link>https://blog.paraspatidar.com/<image><url>https://blog.paraspatidar.com/favicon.png</url><title>Paras Patidar's Blog</title><link>https://blog.paraspatidar.com/</image><generator>Ghost 2.10</generator><lastbuilddate>Wed, 16 Jan 2019 11:41:06 GMT</lastbuilddate><link href="https://blog.paraspatidar.com/rss/" rel="self" type="application/rss+xml"><ttl>60</ttl><item><title></title><description><p>As we all know that Azure App Services uses sticky session by default in case of multiple instance (i.e. load balancing between multiple VM which are running your web application) ,  </p><p>those sticky session are maintained by a cookie key named <strong>ARRAffinity</strong> .</p><p>for all the running instances , there is is</p>]]&gt;</description><link>https://blog.paraspatidar.com/web-app-instance-name-and-arr-affinity-mapping-using-function-app-part-1/<guid ispermalink="false">5c3f12358aec57239c69bd8c</guid><category></category><category></category><category></category><category></category><category></category><category></category><creator></creator><pubdate>Wed, 16 Jan 2019 11:34:30 GMT</pubdate><encoded><p>As we all know that Azure App Services uses sticky session by default in case of multiple instance (i.e. load balancing between multiple VM which are running your web application) ,  </p><p>those sticky session are maintained by a cookie key named <strong>ARRAffinity</strong> .</p><p>for all the running instances , there is is this unique value and based on this cookie value , browser’s request is redirected to specific instance.</p><p>While instances(VMs) has some standard name like : <strong>RD00</strong>XXXXXXX  , <strong>ARRAffinity</strong>  is some random alphanumeric . </p><p>You can delete these cookie key and try to connect to web app by refreshing url again , you will randomly get any of the <strong>ARRAffinity</strong>  key and your browser request will connect to the instance associated with that <strong>ARRAffinity.</strong></p><figure class="kg-card kg-image-card"><img src="https://blog.paraspatidar.com/content/images/2019/01/image.png" class="kg-image"><figcaption>arr affinity f12 developer option cookie</figcaption></figure><p></p><p>However In day to day app service maintenance and troubleshooting related issue , we may have requirement to connect to only any specific instance , for example manipulating anything on that instance only , Getting memory dump from that instance , killing any specific process on any particular instance  and lot many other requirements.</p><p>This requirement has two major challenges :</p><p>1. Identifying <strong>ARRAffinity</strong> cookie for any specific instance .</p><p>2. Once we know that <strong>ARRAffinity</strong>  , then using various available options , connect to that specific instance.</p><p>Lets discuss about both these challenges :</p><p><strong><em>Challange 1:   Identifying ARRAffinity cookie for any specific instance  :</em></strong></p><p> There is no out of the box UI  available to get the <strong>ARRAffinity</strong> of any specific instance  , but here are some options :</p><p><strong>Method 1 :</strong> </p><p>		Using steps mentioned in <a href="https://blogs.msdn.microsoft.com/kaushal/2016/11/21/azure-app-service-how-to-connect-to-the-kudu-site-of-a-specific-instance/">this blog post here</a>, you can get all <strong>ARRAffinity</strong>  , but you would not get the instance name, so you may try connecting all those instances one by one to verify which one is of your interest.</p><p>     many hits &amp; trials involved to reach to correct Instance …so lets move to next method.</p><p><strong>Method 2 :</strong> </p><p>		Using  a Powershell  <a href="https://github.com/paraspatidar/Code-Dump/blob/master/InstanceName_ArrAffinityCombination.ps1">script located here</a> , you can get the      list of Instance name with their <strong>ARRAffinity</strong>    value , but this has the limitation that :</p><ol><li>you must run this script every time you want to find the information</li><li>login with your account</li><li>you must be on a machine capable to run PowerShell script and of course</li><li>you need that powershell script handy</li></ol><p>           …………….phew………</p><p><strong><em>Challange 2:   Identifying ARRAffinity cookie for any specific instance  :</em></strong></p><p> <strong>Method 1 :</strong> </p><p>		Using Browser extension to edit the cookie , once we know the <strong>ARRAffinity</strong>   ,  we can connect to specific instance by using recommendation as <a href="https://blogs.msdn.microsoft.com/kaushal/2016/11/21/azure-app-service-how-to-connect-to-the-kudu-site-of-a-specific-instance/%20">in this post here</a>.</p><p><strong>Method 2 :</strong> </p><p>		Using some Azure App Service extension like <strong>Instance Detective by </strong><a href="https://github.com/nmallick1/MutliConsoleExt">Nazeef Mallick</a> , which will help you to directly connect to any specific instance , but only issue is :</p><ol><li>you need to instance this extension to some site</li><li>you should have KUDU access for that site</li><li>you should have publish profile handy for the app service for which you want to connect to particular instance.</li></ol><p> If above  challenges are not the concern , then I would recommend to use above extension , </p><p>but if you are looking for some <em><strong>automated way</strong></em> where you don’t need to do anything manual to find <strong>ARRAffinity</strong>    &amp; Instance name combination , then this Post is for you.</p><h3 id="goal-of-this-post-"><u>Goal of this Post :</u></h3><p>In this post we shall discuss on some <strong>one time activity</strong> on your azure portal , which will finally<strong> create a Http trigger based Function app</strong>   with an URL.</p><p>once that is done , <strong>passing any web app name &amp; resource group name</strong> to that URL will <strong>return all running instances</strong> of web application as well as their <strong>ARRAffinity</strong>  Id , so anyone can query this read-only data from any device which is capable of making normal HTTP call , thus any computing device limitation , any script limitation , any manual effort is gone.</p><p>So if are excited about this automation ,then continue further part in  my next Post here :</p>]]&gt;</encoded></item></channel>